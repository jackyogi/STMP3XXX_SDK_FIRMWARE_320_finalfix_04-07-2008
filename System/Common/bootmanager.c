////////////////////////////////////////////////////////////////////////////////
// Copyright(C) SigmaTel, Inc. 2002
//
// File : sysirq.c
// Description : 
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
//  Macros
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
//  Includes
////////////////////////////////////////////////////////////////////////////////

#include "types.h"

////////////////////////////////////////////////////////////////////////////////
//  External Definitions
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
//  External References
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
//  Equates
////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////
// Prototypes
///////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
//  X Memory
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
//  Y Memory
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
//  P Memory
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
//
//>  Name:          BootManager
//
//   Type:          Function
//
//   Description:   
//
//   Inputs:        
//
//   Outputs:       none
//
//   Notes:         none
//<
////////////////////////////////////////////////////////////////////////////////
void _reentrant BootManager(WORD wBootTag, BOOL bIsResident)
{
    
    // For now we're ignoring the bIsResident switch because the compiler puts
    //   an rts in front of the jmp instruction if it's within the if statement.
    #pragma asm
        jmp     p:$80
    #pragma endasm

    if(bIsResident)
    {
        // TODO:  figure out why compiler puts an rts BEFORE the jmp.
        // TODO:  abstract this address
        #pragma asm
            jmp     p:$80
        #pragma endasm
        
    }
    else
    {
        // must load the BootManager from somewhere :)
        SystemHalt();
    }
}

